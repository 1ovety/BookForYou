<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="bookMapper">

	<resultMap id="bookResult" type="Book">
		<result column="bk_no" property="bkNo"/>
		<result column="sub_cate_no" property="subCateNo"/>
		<result column="bk_title" property="bkTitle"/>
		<result column="bk_publish" property="bkPublish"/>
		<result column="bk_date" property="bkDate"/>
		<result column="bk_price" property="bkPrice"/>
		<result column="intro_originname" property="introOriginName"/>
		<result column="intro_changename" property="introChangeName"/>
		<result column="bk_stock" property="bkStock"/>
		<result column="bk_seldate" property="bkSelDate"/>
		<result column="bk_mdate" property="bkModiDate"/>
		<result column="bk_selstatus" property="bkSelStatus"/>
		<result column="bk_age" property="bkAge"/>
		<result column="bk_gender" property="bkGender"/>
		<result column="bk_work" property="bkWork"/>
		<result column="bk_level" property="bkLevel"/>
		<result column="bk_status" property="bkStatus"/>
		<result column="writer_name" property="writerName"/>
		<result column="writer_intro" property="writerIntro"/>
		<result column="writer_origin_name" property="writerOriginName"/>
		<result column="writer_change_name" property="writerChangeName"/>
		<result column="bk_content" property="bkContent"/>
	</resultMap>
	
	<!-- [관리자] 전체 도서 개수 조회 (한진) -->
	<select id="selectAllListCount" resultType="_int">
		select 
			   count(*)
	      from book
	</select>

	<!-- [관리자] 전체 도서 목록 조회 (한진) -->
	<select id="selectAdminBookList" resultMap="bookResult">
		select 
		       bk_no,
		       sub_cate_no,
		       bk_title,
		       bk_publish,
		       bk_date,
		       bk_price,
		       intro_originname,
		       intro_changename,
		       bk_stock,
		       bk_seldate,
		       bk_mdate,
		       bk_selstatus,
		       bk_age,
		       bk_gender,
		       bk_work,
		       bk_level,
		       bk_status,
		       writer_name,
		       writer_intro,
		       writer_origin_name,
		       writer_change_name,
		       bk_content
		  from book
		 order
    		by bk_date desc
	</select>
	
	<select id="selectSearchBookCount" resultType="_int">
		select
		       count(*)
		  from book
		 where bk_selstatus = 'Y'
	 	<choose>
	 		<when test="condition == 'searchAll'">
	 			and bk_title
	 		</when>
	 		<when test="condition == 'bookTitle'">
	 			and bk_title
	 		</when>
	 		<otherwise>
	 			and writer_name
	 		</otherwise>
	 	</choose>
	 	like '%' || #{keyword} || '%'
	</select>
	
	<select id="selectSearchBook" resultMap="bookResult">
		select
		       bk_no
		     , sub_cate_no
		     , bk_title
		     , bk_publish
		     , bk_price
		     , bk_date
			 , bk_price,
		     , intro_originname
		     , intro_changename
		     , bk_stock
		     , bk_seldate
		     , bk_mdate
		     , bk_selstatus
		     , bk_age
		     , bk_gender
		     , bk_work
		     , bk_level
		     , bk_status
		     , writer_name
		     , writer_intro
		     , writer_origin_name
		     , writer_change_name
		     , bk_content
		  from book
		 where bk_selstatus = 'Y'
	 	<choose>
	 		<when test="condition == 'searchAll'">
	 			and bk_title
	 		</when>
	 		<when test="condition == 'bookTitle'">
	 			and bk_title
	 		</when>
	 		<otherwise>
	 			and writer_name
	 		</otherwise>
	 	</choose>
	 			like '%' || #{keyword} || '%'
		 order
		    by bk_no desc
	</select>
	
	<!-- [관리자] '판매중'인 도서 개수 조회 (한진) -->
	<select id="selectStatusYCount" resultType="_int">
		select 
			   count(*)
	      from book
	     where bk_status = '판매중'
	</select>
	
	<!-- [관리자] 게시 'Y'인 도서 개수 조회 (한진) -->
	<select id="selectSelStatusYCount" resultType="_int">
		select 
			   count(*)
	      from book
	     where bk_selstatus = 'Y'
	</select>
	
	<!-- [관리자] 검색조건에 일치하는 도서 개수 조회 (한진) -->
	<select id="selectAdminSearchCount" resultType="_int">
		select
			   count(*)
		  from book
		<choose>
			<when test="condition == 'AllBook'">
				where bk_title
				   or writer_name
				   or bk_publish
			</when>
			<when test="condition == 'bookNo'">
				  where bk_no
			</when>		
			<when test="condition == 'bookTitle'">
				  where bk_title
			</when>
			<when test="condition == 'bookWriter'">
				  where writer_name
			</when>
			<otherwise>
				  where bk_publish
			</otherwise>
		</choose>
		like '%' || #{keyword} || '%'
		
		<if test="bkStatus != null">
			<choose>
				<when test="bkStatus == 'StatusAll'">
					  and bk_status = '판매중' 
					   or bk_status = '품절'
				</when>
				<when test="bkStatus == 'statusY'">
					  and bk_status = '판매중'
				</when>
				<otherwise>
					  and bk_status = '품절'
				</otherwise>				
			</choose>
		</if>
		<if test="selStatus != null">
			<choose>
				<when test="bkSelStatus == 'selStatusAll'">
					  and sel_status = 'Y'
					   or sel_status = 'N'
				</when>
				<when test="bkSelStatus == 'selStatusY'">
					  and sel_status = 'Y'
				</when>
				<otherwise>
					  and sel_status = 'N'
				</otherwise>
			</choose>
		</if>	
		
	</select>
	
	<!-- [관리자] 검색조건에 일치하는 도서 목록 조회 (한진) -->
	<select id="selectAdminSearchList" resultMap="bookResult">
		select 
		       bk_no,
		       sub_cate_no,
		       bk_title,
		       bk_publish,
		       bk_date,
		       bk_price,
		       intro_originname,
		       intro_changename,
		       bk_stock,
		       bk_seldate,
		       bk_mdate,
		       bk_selstatus,
		       bk_age,
		       bk_gender,
		       bk_work,
		       bk_level,
		       bk_status,
		       writer_name,
		       writer_intro,
		       writer_origin_name,
		       writer_change_name,
		       bk_content
		  from book
		 <choose>
			<when test="condition == 'AllBook'">
				where bk_title
				   or writer_name
				   or bk_publish
			</when>
			<when test="condition == 'bookNo'">
				  where bk_no
			</when>		
			<when test="condition == 'bookTitle'">
				  where bk_title
			</when>
			<when test="condition == 'bookWriter'">
				  where writer_name
			</when>
			<otherwise>
				  where bk_publish
			</otherwise>
		</choose>
		like '%' || #{keyword} || '%'
		
		<if test="bkStatus != null">
			<choose>
				<when test="bkStatus == 'StatusAll'">
					  and bk_status = '판매중' 
					   or bk_status = '품절'
				</when>
				<when test="bkStatus == 'statusY'">
					  and bk_status = '판매중'
				</when>
				<otherwise>
					  and bk_status = '품절'
				</otherwise>				
			</choose>
		</if>
		<if test="selStatus != null">
			<choose>
				<when test="selStatus == 'selStatusAll'">
					  and sel_status = 'Y'
					   or sel_status = 'N'
				</when>
				<when test="selStatus == 'selStatusY'">
					  and sel_status = 'Y'
				</when>
				<otherwise>
					  and sel_status = 'N'
				</otherwise>
			</choose>
		</if>	
	</select>
	
	
</mapper>
