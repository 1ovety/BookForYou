<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="groupMapper">
	
	<resultMap type="GroupBoard" id="groupResult">
			<result column="group_boardno" property="groupBoardNo"/>
			<result column="group_type" property="groupType"/>
			<result column="group_title" property="groupTitle"/>
			<result column="group_script" property="groupScript"/>
			<result column="group_date" property="groupDate"/>
			<result column="group_limit" property="groupLimit"/>			
			<result column="group_notice" property="groupNotice"/>			
			<result column="group_place" property="groupPlace"/>			
			<result column="group_open" property="groupOpen"/>		
			<result column="origin_name" property="originName"/>
			<result column="change_name" property="changeName"/>
			<result column="group_writer" property="groupWriter"/>
			<result column="group_status" property="groupStatus"/>
			<result column="group_count" property="groupCount"/>

						
	</resultMap>
	
	<resultMap type="GroupMember" id="groupMemberResult">
		
			<result column="group_boardno" property="groupBoardNo"/>
			<result column="group_enrolldate" property="groupEnrollDate"/>
			<result column="mem_email" property="memEmail"/>
			<result column="group_level" property="groupLevel"/>
			<result column="group_withdraw" property="groupWithdraw"/>
			<result column="group_reason" property="groupReason"/>

		
	</resultMap>
	
	
	<select id="selectList" resultMap="groupResult" >
		SELECT *              
        FROM (SELECT ROWNUM NUM 
            , s.group_boardno 
            , s.group_type
            , s.group_date
            , s.group_title
            , s.group_script
            , s.group_place
            , s.change_name
            , s.group_status
            FROM 
           (SELECT * FROM GROUPBOARD 
            WHERE GROUP_STATUS = 'Y'  
      ORDER BY GROUP_BOARDNO DESC)s) 
        WHERE NUM BETWEEN 1 AND 4
          
	
	</select>
	
	<select id="selectListMore" resultMap="groupResult">
		select *             
        FROM (SELECT ROWNUM NUM 
            , s.group_boardno 
            , s.group_type
            , s.group_title
            , s.group_script
            , s.group_place
            , s.change_name
            
              FROM 
                    (SELECT * FROM GROUPBOARD 
             		WHERE GROUP_STATUS = 'Y'
                    ORDER BY GROUP_BOARDNO DESC)s) 
        WHERE NUM BETWEEN 5+(4*#{more}) AND 8+(4*#{MORE})
                  
        
	</select>
	
	<update id="increaseCount">
		update
				groupBoard
			set group_count = group_count + 1
		  where group_boardno = #{groupBoardNo}
		    and group_status = 'Y' 
	</update>
	
	<insert id="insertGMem">
		
		 
		insert 
		  into groupMember
		  (
		  	group_boardno
		  , mem_no
		  ,	group_enrolldate
		  ,	mem_email
		  ,	group_level
		  , group_withdraw
		  , group_reason
		  )
		  values
		  (
		  	seq_gno.nextval
		  , #{memNo} 
		  , sysdate
		  , #{memEmail}
		  , #{groupLevel}
		  , #{groupWithdraw}
		  , #{groupReason}
		  )
		  
	</insert>
	
	<select id="groupMemberList" resultMap="groupMemberResult">
		select
		       group_boardno
		      ,group_enrolldate
		      ,group_email
		      ,group_level
		  from groupMember
		  order
		  	 by group_enrolldate desc
				
	</select>
	
	<select id="groupMemberCount" resultType="_int">
		SELECT 
             count(*)
            
              from groupBoard g 
             where g.group_status= 'Y'
    </select>
	
	<select id="selectSearchGListCount" resultType="_int">
		SELECT 
             count(*)
            
              from groupBoard g 
             where g.group_status= 'Y'
             
          
            <if test="condition == 'groupTitle'">
            where group_title
           </if>
           <if test="condition == 'groupScript'">
            and group_script
            </if>
           <if test="condition == 'groupPlace'">
            and group_place
            </if>
	     		like '%' || #{keyword} || '%'
             
	</select>
	 
	 
	<select id="selectSearchList" resultMap="groupResult">
			SELECT 
            group_boardno 
            , group_type
            , group_title
            , group_script
            , group_place
            , change_name
            
              from groupBoard g 
             where g.group_status= 'Y'
             
            <choose>
            <when test="condition == 'groupTitle'">
            where group_title
           </when>
           <when test="condition == 'groupScript'">
            and group_script
            </when>
            <otherwise>
            and group_place
            </otherwise>
           </choose>
	     		like '%' || #{keyword} || '%'
             
	</select>


	<insert id="insertGBoard">
		insert
		  into groupBoard
		  (
		  group_boardno
		 ,group_type
		 ,group_title
		 ,group_place
		 ,group_script
		 ,group_limit
		 ,change_name
		 ,group_open
		  )
		  values
		  (
		  seq_gno.nextval
		 ,#{groupType}
		 ,#{groupTitle}
		 ,#{groupPlace}
		 ,#{groupScript}
		 ,#{groupLimit}
		 ,#{changeName}
		 ,#{groupOpen}
		  )
	
	</insert>
	
	<select id="selectGroup" resultMap="groupResult">
		select
		 		group_boardno
		 	 ,  group_title
		 	 ,  group_writer
		 	 , 	group_date
			 ,  change_name
			 ,  group_script
			 ,  group_notice
	     from  groupBoard
	    where  group_boardNo = #{groupBoardNo}
	</select>
	
	<update id="deleteGroup">
		update 
				groupBoard
		   set group_status ='N'
		  where group_boardno = #{groupBoardNo}
	
	</update>
	
	<update id="updateGroup">
	
		update
				groupBoard
		   set  
		   	      group_boardno = #{groupBoardNo}
				 ,group_writer = #{groupWriter}
				 ,group_type = #{groupType}
				 ,group_title = #{groupTitle}
				 ,group_place = #{groupPlace}
				 ,group_script = #{groupScript}
				 ,group_limit = #{groupLimit}
				 ,origin_name = #{originName}
				 ,change_name = #{changeName}
				 ,group_open = #{groupOpen}
				 
		 where group_boardno = #{groupBoardNo}
	</update>
	
	<!-- 마이페이지에 쓰이니 삭제하지 말아주세요 -->
	<!-- [사용자] 마이페이지 내가 속한 그룹 리스트들 개수 조회 (세아) -->
	<select id="selectMyReadingGroupListCount" resultType="_int">
		select
			count(*)
		from groupmember
		where mem_no = #{memNo}
			and not group_level = 'N'
	</select>

	<!-- [사용자] 마이페이지 내가 속한 그룹의 총 멤버 회원수 조회(세아) -->
	<select id="selectMyReadingGroupMemberCount" resultType="_int">
		select count(*)
		from groupmember
		where group_boardno = #{groupBoardNo} 
			and not group_level = 'N'
	</select>

	<!-- [사용자] 마이페이지 내가 속한 그룹의 리스트 조회(세아) -->
	<select id="selectMyReadingGroupList" resultMap="groupResult">
		select group_boardno,
			   m.mem_no,
			   group_level,
			   group_type,
			   group_title,
			   group_script,
			   group_date,
			   group_status,
			   group_writer,
			   origin_name,
			   change_name
		from groupboard g
		join groupmember m using(group_boardno)
		where group_status = 'Y' 
			and not group_level = 'N' 
			and m.mem_no=#{memNo}
	</select>
	
</mapper>
