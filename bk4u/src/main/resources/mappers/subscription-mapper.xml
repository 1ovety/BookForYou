<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="subscriptionMapper">

	<resultMap type="Subscription" id="SubscResult">
		<result column="subsc_no" property="subscNo"/>
		<result column="mem_no" property="memNo"/>
		<result column="pay_no" property="payNo"/>
		<result column="coupon_issue_no" property="couponIssueNo"/>
		<result column="subsc_name" property="subscName"/>
		<result column="subsc_period" property="subscPeriod"/>
		<result column="subsc_price" property="subscPrice"/>
		<result column="subsc_sdate" property="subscSdate"/>
		<result column="subsc_enddate" property="subscEndDate"/>
		<result column="subsc_deldate" property="subscDelDate"/>
		<result column="subsc_status" property="subscStatus"/>
		<result column="subsc_receiver" property="subscReceiver"/>
		<result column="subsc_post" property="subscPost"/>
		<result column="subsc_address" property="subscAddress"/>
		<result column="address_detail" property="addressDetail"/>
		<result column="address_ref" property="address_ref"/>
		<result column="subsc_phone" property="subsc_phone"/>
		<result column="deliveryrequest" property="deliveryRequest"/>
		<result column="admin_memo" property="adminMemo"/>
		<result column="mem_name" property="memName"/>
		<result column="mem_id" property="memId"/>
		<result column="status" property="payStatus"/>
	</resultMap>

	<!-- [관리자] 정기구독 목록 개수 조회 (한진) -->
	<select id="selectAllListCount" resultType="_int">
		select 
		       count(*)
		  from subscription
	</select>

	<!-- [관리자] 정기구독 목록 조회 (한진) -->
	<select id="selectAdminSubscList" resultMap="SubscResult">
		select
		       subsc_no,
		       mem_name,
		       mem_id,
		       p.status,
		       subsc_sdate,
		       subsc_enddate,
		       subsc_name,
		       subsc_period,
		       subsc_price,
		       subsc_deldate,
		       subsc_status,
		       subsc_receiver,
		       deliveryrequest,
		       admin_memo
		  from subscription
		  join members using (mem_no)
		  join payment p using (pay_no)
		  <choose>
		  	<when test="subscStatus == 1">
		  		where subsc_name = '베이직'
		  	</when>
		  	<when test="subscStatus == 2">
		  		where subsc_name = '프리미엄'
		  	</when>
		  	<when test="subscStatus == 3">
		  		where subsc_status = 'Y'
		  	</when>
		  	<when test="subscStatus == 4">
		  		where subsc_status = 'N'
		  	</when>
		  </choose>
		 order
		    by
		  <choose>
		  		<when test="array == 0">
		  			subsc_sdate desc
		  		</when>
		  		<when test="array == 1">
		  			subsc_sdate asc
		  		</when>
		  </choose>
	</select>
	
	<!-- [관리자] '베이직' 목록 개수 조회 (한진) -->
	<select id="selectBasicListCount" resultType="_int">
		select 
		       count(*)
		  from subscription
		 where subsc_name = '베이직'
	</select>
	
	<!-- [관리자] '프리미엄' 목록 개수 조회 (한진) -->
	<select id="selectPremiumListCount" resultType="_int">
		select 
		       count(*)
		  from subscription
		 where subsc_name = '프리미엄'
	</select>
	
	<!-- [관리자] '구독중' 목록 개수 조회 (한진) -->
	<select id="selectStatusYListCount" resultType="_int">
		select 
		       count(*)
		  from subscription
		 where subsc_status = 'Y'
	</select>
	
	<!-- [관리자] '구독해지' 목록 개수 조회 (한진) -->
	<select id="selectStatusNListCount" resultType="_int">
		select 
		       count(*)
		  from subscription
		 where subsc_status = 'N'
	</select>
	
	<!-- [관리자] 검색조건에 일치하는 목록 개수 조회 (한진) -->
	<select id="selectAdminSubscListSearchCount" resultType="_int">
		select
			   count(*)
		  from subscription
		  join members using (mem_no)
		  where subsc_no > 0
		<choose>
		 	<when test="subscStatus == 1">
		 		and subsc_name = '베이직'
		 	</when> 
		 	<when test="subscStatus == 2">
		 		and subsc_name = '프리미엄'
		 	</when>	
		 	<when test="subscStatus == 3">
		 		and subsc_status = 'Y'
		 	</when>
		 	<when test="subscStatus == 4">
		 		and subsc_status = 'N'
		 	</when>
		 </choose>
		<choose>
			<when test="condition == 'searchAll'">
				and subsc_no like '%' || #{keyword} || '%'
				   or mem_name like '%' || #{keyword} || '%'
				   or mem_id
			</when>
			<when test="condition == 'subscNo'">
				  and order_no
			</when>		
			<when test="condition == 'memName'">
				  and mem_name
			</when>
			<when test="condition == 'memId'">
				  and mem_id
			</when>
		</choose>
		like '%' || #{keyword} || '%'
	</select>
	
	<!-- [관리자] 검색조건에 일치하는 목록 조회 (한진) -->
	<select id="selectAdminSubscSearchList" resultMap="SubscResult">
		select
			   subsc_no,
		       mem_name,
		       mem_id,
		       p.status,
		       subsc_sdate,
		       subsc_enddate,
		       subsc_name,
		       subsc_period,
		       subsc_price,
		       subsc_deldate,
		       subsc_status,
		       subsc_receiver,
		       deliveryrequest,
		       admin_memo
		  from subscription
		  join members using (mem_no)
		  join payment p using (pay_no)
		 where subsc_no > 0
		<choose>
		 	<when test="subscStatus == 1">
		 		and subsc_name = '베이직'
		 	</when> 
		 	<when test="subscStatus == 2">
		 		and subsc_name = '프리미엄'
		 	</when>	
		 	<when test="subscStatus == 3">
		 		and subsc_status = 'Y'
		 	</when>
		 	<when test="subscStatus == 4">
		 		and subsc_status = 'N'
		 	</when>
		 </choose>
		<choose>
			<when test="condition == 'searchAll'">
				and subsc_no like '%' || #{keyword} || '%'
				   or mem_name like '%' || #{keyword} || '%'
				   or mem_id
			</when>
			<when test="condition == 'subscNo'">
				  and order_no
			</when>		
			<when test="condition == 'memName'">
				  and mem_name
			</when>
			<when test="condition == 'memId'">
				  and mem_id
			</when>
		</choose>
		like '%' || #{keyword} || '%'
		order
		    by
		  <choose>
		  		<when test="array == 0">
		  			subsc_sdate desc
		  		</when>
		  		<when test="array == 1">
		  			subsc_sdate asc
		  		</when>
		  </choose>
	</select>
	
</mapper>
